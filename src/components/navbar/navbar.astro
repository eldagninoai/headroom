---
// src/components/Navbar.astro

const menuItems = [
  { title: "Inicio", path: "/" },
  { title: "Nosotros", path: "/about" },
  { 
    title: "Servicios", 
    path: "#servicios", 
    children: [
      { title: "Equalizer (Mezcla & Mastering)", path: "#equalizer" },
      { title: "Producción de Video", path: "#video" },
      { title: "Diseño Sonoro", path: "#sonido" },
      { title: "Música & Branding", path: "#musica" },
    ]
  },
  { title: "Blog", path: "/blog" },
];
---

<header class="fixed top-0 left-0 w-full z-50 bg-black/90 backdrop-blur-md transition-all duration-300">
  
  <div class="flex flex-col min-[1025px]:flex-row justify-between items-center w-full px-[6vw] min-[1025px]:px-[4.2vw] py-[2vh]">
    
    <div class="flex w-full min-[1025px]:w-auto items-center justify-between">
      
      <a href="/" onclick="sessionStorage.clear()" class="fluid-logo font-black tracking-tighter uppercase text-white hover:text-[#F1EE14] transition-colors">
        Headroom<span class="text-[#F1EE14]">SOUND</span>
      </a>
      
      <button id="menu-toggle" class="block min-[1025px]:hidden text-white focus:outline-none">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
      </button>

    </div>

    <nav id="nav-content" class="hidden w-full min-[1025px]:w-auto min-[1025px]:flex flex-col min-[1025px]:flex-row items-center gap-[4vw] min-[1025px]:gap-[2.5vw] mt-4 min-[1025px]:mt-0">
      
      <ul class="flex flex-col min-[1025px]:flex-row items-center gap-[2vw] w-full min-[1025px]:w-auto">
        {menuItems.map((item) => (
          <>
            {item.children ? (
              /* --- DROPDOWN (SERVICIOS) --- */
              <li class="relative group text-center min-[1025px]:text-left w-full min-[1025px]:w-auto">
                <button class="flex items-center justify-center min-[1025px]:justify-start gap-1 fluid-link text-gray-400 hover:text-white uppercase tracking-widest font-mono py-2 w-full min-[1025px]:w-auto dropdown-trigger">
                  {item.title}
                  <svg class="w-4 h-4 group-hover:rotate-180 transition-transform hidden min-[1025px]:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                  <svg class="w-4 h-4 min-[1025px]:hidden ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                
                <div class="mobile-dropdown hidden min-[1025px]:absolute min-[1025px]:hidden min-[1025px]:group-hover:block top-full left-1/2 min-[1025px]:-translate-x-1/2 pt-4 w-full min-[1025px]:w-[20vw] bg-transparent">
                   <div class="bg-[#0a0a0a] border border-gray-800 rounded-xl p-4 shadow-2xl flex flex-col gap-2">
                      {item.children.map(child => (
                        <a href={child.path} class="block text-gray-400 hover:text-[#F1EE14] text-sm font-mono uppercase text-center min-[1025px]:text-left">
                          {child.title}
                        </a>
                      ))}
                   </div>
                </div>
              </li>
            ) : (
              /* --- LINK NORMAL --- */
              <li class="w-full min-[1025px]:w-auto text-center">
                <a href={item.path} class="fluid-link text-gray-400 hover:text-white uppercase tracking-widest font-mono py-2 block">
                  {item.title}
                </a>
              </li>
            )}
          </>
        ))}
      </ul>

      <div class="flex items-center mt-4 min-[1025px]:mt-0 w-full min-[1025px]:w-auto justify-center">
        <a href="/contact" class="inline-block bg-[#F1EE14] hover:bg-white text-black font-bold uppercase tracking-wider py-[1vh] px-[2vw] fluid-btn transition-all duration-300 rounded-sm">
          Contacto
        </a>
      </div>

    </nav>

  </div>
</header>

<style>
  /* --- TIPOGRAFÍA FLUIDA --- */
  
  /* Logo */
  .fluid-logo {
    /* Móvil/Tablet: 6vw */
    font-size: clamp(1.5rem, 6vw, 2rem); 
  }
  
  /* Links del Menú */
  .fluid-link {
    font-size: 4vw; /* Móvil */
  }

  /* Botón Contacto */
  .fluid-btn {
    font-size: 3.5vw;
  }

  /* --- AJUSTES ESCRITORIO (1025px+) --- */
  @media (min-width: 1025px) {
    .fluid-logo { font-size: 1.5vw; }
    .fluid-link { font-size: 0.85vw; }
    .fluid-btn  { font-size: 0.75vw; }

    /* Lógica de Dropdown en Desktop (Hover) */
    .mobile-dropdown {
        display: none; 
    }
    .group:hover .mobile-dropdown {
        display: block; 
    }
  }
</style>

<script>
  const initNavbar = () => {
    const menuToggle = document.getElementById('menu-toggle');
    const navContent = document.getElementById('nav-content');

    // Validación de seguridad: Si no existen los elementos, no hacemos nada
    if (!menuToggle || !navContent) return;

    // --- 1. BOTÓN HAMBURGUESA (Clonamos SOLO el botón para limpiar eventos viejos) ---
    const newToggle = menuToggle.cloneNode(true);
    if (menuToggle.parentNode) {
        menuToggle.parentNode.replaceChild(newToggle, menuToggle);
    }

    newToggle.addEventListener('click', (e) => {
      e.stopPropagation(); // Evitar que el clic llegue al fondo y lo cierre inmediatamente
      navContent.classList.toggle('hidden');

      if (!navContent.classList.contains('hidden')) {
        navContent.classList.add('h-screen', 'pb-20');
      } else {
        navContent.classList.remove('h-screen', 'pb-20');
      }
    });

    // --- 2. DROPDOWNS (Clonamos sus triggers) ---
    const dropdownTriggers = document.querySelectorAll('.dropdown-trigger');
    dropdownTriggers.forEach(trigger => {
        const newTrigger = trigger.cloneNode(true);
        if (trigger.parentNode) {
            trigger.parentNode.replaceChild(newTrigger, trigger);
        }

        newTrigger.addEventListener('click', (e) => {
            if (window.innerWidth < 1025) {
                e.preventDefault();
                e.stopPropagation(); // Importante: que no cierre el menú
                const dropdown = newTrigger.nextElementSibling;
                if (dropdown) dropdown.classList.toggle('hidden');
            }
        });
    });

    // --- 3. CERRAR AL TOCAR FONDO O LINKS (Sin clonar el contenedor) ---
    // Usamos 'onclick' directo para sobrescribir cualquier evento anterior automáticamente
    navContent.onclick = (e) => {
        // Solo en móvil
        if (window.innerWidth >= 1025) return;

        // Si tocaste un botón de dropdown, NO cierres
        if (e.target.closest('.dropdown-trigger')) return;

        // Si tocaste cualquier otra cosa (fondo negro o un link normal) -> CERRAR
        navContent.classList.add('hidden');
        navContent.classList.remove('h-screen', 'pb-20');
    };
  };

  // Ejecutar al inicio
  initNavbar();

  // Ejecutar en cada navegación de Astro
  document.addEventListener('astro:page-load', initNavbar);
</script>