---
// src/components/SubServicios.astro
import heroImage from '../assets/hero.png';

const placeholderImg = heroImage.src;

const data = {
  equalizer: {
    summary: "Nuestro servicio de ecualización y mezcla asegura que cada elemento sonoro tenga su espacio perfecto. Desde la claridad de los diálogos hasta la potencia de los graves, equilibramos el espectro para una experiencia auditiva inmersiva y profesional en cualquier dispositivo.",
    services: [
      { title: "Mezcla Estéreo & Surround", img: heroImage.src, link: "#" },
      { title: "Mastering Digital", img: heroImage.src, link: "#" },
      { title: "Edición de Diálogos", img: heroImage.src, link: "#" },
      { title: "Restauración de Audio", img: heroImage.src, link: "#" }
    ]
  },
  video: {
    summary: "Transformamos la narrativa visual mediante procesos de postproducción de alta gama. El color grading aporta la atmósfera emocional, mientras que nuestra edición offline construye el ritmo perfecto para contar tu historia visualmente.",
    services: [
      { title: "Color Grading", img: placeholderImg, link: "#" },
      { title: "Edición Offline", img: placeholderImg, link: "#" },
      { title: "VFX Básicos", img: placeholderImg, link: "#" }
    ]
  },
  sonido: {
    summary: "Creamos mundos sonoros desde cero. El diseño sonoro no es solo lo que se ve, sino lo que se siente. Desde pasos y roces (Foley) hasta ambientes complejos que dan vida y realismo a cada escena.",
    services: [
      { title: "Foley & SFX", img: placeholderImg, link: "#" },
      { title: "Diseño de Ambientes", img: placeholderImg, link: "#" }
    ]
  },
  musica: {
    summary: "La música es el alma de tu marca. Componemos piezas originales que definen tu identidad sonora o gestionamos las licencias necesarias para que tu proyecto suene exactamente como lo imaginaste, sin problemas legales.",
    services: [
      { title: "Composición Original", img: placeholderImg, link: "#" },
      { title: "Licencias & Sync", img: placeholderImg, link: "#" }
    ]
  }
};

const defaultCategory = data.equalizer;
const defaultTitle = "// EQUALIZER"; 
---

<section id="display-area" class="zona-subservicios mx-auto fade-in flex flex-col min-[1025px]:flex-row gap-[8vw] min-[1025px]:gap-[2vw] items-center min-[1025px]:items-start">
    
    <div class="w-full min-[1025px]:w-2/3 order-2 min-[1025px]:order-1 flex flex-col">
        <h4 id="category-title" class="text-[#F1EE14] font-mono mb-[3vh] min-[1025px]:mb-[1.5vw] uppercase tracking-widest border-l-0 min-[1025px]:border-l-4 border-[#F1EE14] min-[1025px]:pl-[1vw] fluid-text-xl text-center min-[1025px]:text-left">
          {defaultTitle}
        </h4>

        <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 gap-[3vw] min-[1025px]:gap-[1.5vw] w-full">
           {defaultCategory.services.map(service => (
              <div class="service-card group">
                  <div class="img-container">
                    <img src={service.img} alt={`Servicio de ${service.title}`}>
                  </div>
                  <div class="card-overlay"></div> 
                  <h3 class="card-title text-center min-[1025px]:text-left">{service.title}</h3>
              </div>
           ))}
        </div>
    </div>

    <div class="w-full min-[1025px]:w-1/4 order-1 min-[1025px]:order-2 bg-[#0a0a0a] border border-gray-800 p-[5vw] min-[1025px]:p-[1vw] rounded-xl relative min-[1025px]:sticky min-[1025px]:top-[6vw] min-[1025px]:mt-[1vw] text-center min-[1025px]:text-left">
        <h5 class="text-white font-bold uppercase mb-[2vh] min-[1025px]:mb-[1vw] tracking-wider flex items-center justify-center min-[1025px]:justify-start fluid-text-sm">
            <span class="text-[#F1EE14] mr-2">//</span> Resumen de Categoría
        </h5>
        <p id="category-summary" class="text-gray-400 font-mono leading-relaxed fluid-text-sm">
            {defaultCategory.summary}
        </p>
    </div>

</section>

<style>
  /* --- 1. ESTRATEGIA MÓVIL/TABLET/IPAD (Por defecto) --- */
  .zona-subservicios {
    width: 90%;      /* Ancho seguro en móvil */
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;   /* SIN overlap en móvil */
    padding-top: 5vh;
    padding-bottom: 10vh;
    position: relative; 
    z-index: 20; 
  }

  /* Tipografía Móvil */
  .fluid-text-xl { font-size: 6vw; }  
  .fluid-text-sm { font-size: 3.5vw; } 

  /* Tarjetas Móvil (Altas para tocar) */
  :global(.service-card) {
    position: relative;
    background-color: #000;
    border: 2px solid #333;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
    height: 18vw; 
    /* Borde seguro en REM para móvil/tablet */
    border-radius: 0.75rem; 
  }

  /* Título Tarjeta Móvil */
  :global(.card-title) {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    z-index: 2;
    color: #FFF;
    font-family: monospace;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 3.5vw;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    transition: color 0.3s;
    display: flex;
    justify-content: center;
    align-items: flex-end;
  }

  /* --- 2. ESTRATEGIA ESCRITORIO (Ahora sí: 1025px en adelante) --- */
  @media (min-width: 1025px) {
    
    .zona-subservicios {
      /* Tus valores exactos de PC: */
      width: 63vw; 
      margin-left: 31.2vw; 
      margin-right: 0;
      margin-top: -13vw; /* Overlap solo en PC */
      
      padding-top: 0;
      padding-bottom: 5vw; 
    }

    /* Tipografía Escritorio */
    .fluid-text-xl { font-size: 1.05vw; }
    .fluid-text-sm { font-size: 0.75vw; }

    /* Tarjetas Escritorio */
    :global(.service-card) {
      height: 5vw; 
      border-radius: 1vw; /* Borde fluido solo en PC */
    }

    /* Título Tarjeta Escritorio */
    :global(.card-title) {
      bottom: 0.6vw;
      left: 1vw;
      right: 1vw;
      padding: 0;
      font-size: 0.8vw;
      justify-content: flex-start; /* Izquierda */
    }
  }

  /* --- ESTILOS COMUNES --- */
  .fade-in {
    animation: fadeIn 0.4s ease-out forwards;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  :global(.service-card:hover) {
    border-color: #F1EE14;
    box-shadow: 0 0 20px rgba(241, 238, 20, 0.2);
  }

  :global(.img-container) {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  :global(.service-card img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: grayscale(100%) brightness(0.7);
    transition: all 0.5s ease;
  }

  :global(.service-card:hover img) {
    filter: grayscale(0%) brightness(1);
    transform: scale(1.05);
  }

  :global(.card-overlay) {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0) 100%);
      z-index: 1;
  }

  :global(.service-card:hover .card-title) {
    color: #F1EE14;
  }
</style>

<script define:vars={{ data }}>
  document.addEventListener('DOMContentLoaded', () => {
    const cardsContainer = document.getElementById('cards-container');
    const categoryTitle = document.getElementById('category-title');
    const categorySummary = document.getElementById('category-summary');
    
    const triggers = document.querySelectorAll('.service-trigger');

    triggers.forEach(trigger => {
      trigger.addEventListener('click', (e) => {
        e.preventDefault(); 
        const triggerBtn = trigger.closest('.service-trigger');
        if (!triggerBtn) return;

        const categoryName = triggerBtn.getAttribute('data-category');
        const categoryData = data[categoryName];

        if (categoryData) {
          categoryTitle.innerText = `// ${categoryName.toUpperCase()}`;
          categorySummary.innerText = categoryData.summary;
          cardsContainer.innerHTML = '';
          
          categoryData.services.forEach(service => {
            const card = document.createElement('div');
            card.className = 'service-card group'; 
            card.innerHTML = `
                <div class="img-container">
                  <img src="${service.img}" alt="${service.title}">
                </div>
                <div class="card-overlay"></div> 
                <h3 class="card-title text-center min-[1025px]:text-left">${service.title}</h3>
            `;
            card.addEventListener('click', () => window.location.href = service.link);
            cardsContainer.appendChild(card);
          });
        }
      });
    });
  });
</script>